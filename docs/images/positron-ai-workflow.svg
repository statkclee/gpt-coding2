<svg xmlns="http://www.w3.org/2000/svg" viewBox="20 50 900 540">
  <defs>
    <style>
      .tufte-text {
        font-family: Palatino, 'Book Antiqua', Georgia, serif;
        fill: #333;
        font-size: 13px;
      }
      .tufte-title {
        font-family: Palatino, 'Book Antiqua', Georgia, serif;
        fill: #333;
        font-size: 16px;
        font-weight: bold;
      }
      .tufte-small {
        font-family: Palatino, 'Book Antiqua', Georgia, serif;
        fill: #666;
        font-size: 11px;
      }
      .tufte-box {
        fill: #f5f5f5;
        stroke: #333;
        stroke-width: 2;
      }
      .tufte-box-highlight {
        fill: #e5e5e5;
        stroke: #333;
        stroke-width: 2;
      }
      .tufte-line {
        stroke: #666;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrow);
      }
      .tufte-bg {
        fill: #ffffff;
      }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect x="20" y="0" width="900" height="650" class="tufte-bg"/>

  <!-- Title -->
  <!-- <text x="450" y="30" class="tufte-title" text-anchor="middle" font-size="18">Positron AI 워크플로우: 세션 상태 인식 기반 코드 생성</text> -->

  <!-- Step 1: User Request -->
  <rect x="50" y="70" width="200" height="80" class="tufte-box"/>
  <text x="150" y="95" class="tufte-text" text-anchor="middle" font-weight="bold">1. 사용자 요청</text>
  <text x="150" y="115" class="tufte-small" text-anchor="middle">"penguins 데이터셋에서</text>
  <text x="150" y="130" class="tufte-small" text-anchor="middle">종별 몸무게 분포를</text>
  <text x="150" y="145" class="tufte-small" text-anchor="middle">박스플롯으로 그려줘"</text>

  <!-- Arrow 1 to 2 -->
  <path d="M 250 110 L 320 110" class="tufte-line"/>
  <text x="285" y="100" class="tufte-small" text-anchor="middle" fill="#999">Assistant 호출</text>

  <!-- Step 2: AI Analyzes Session State -->
  <rect x="320" y="70" width="260" height="80" class="tufte-box-highlight"/>
  <text x="450" y="95" class="tufte-text" text-anchor="middle" font-weight="bold">2. AI 세션 상태 파악</text>
  <text x="450" y="115" class="tufte-small" text-anchor="middle">✓ 메모리에 penguins 로드됨</text>
  <text x="450" y="130" class="tufte-small" text-anchor="middle">✓ ggplot2 패키지 설치됨</text>
  <text x="450" y="145" class="tufte-small" text-anchor="middle">✓ 열 구조: species, body_mass_g 확인</text>

  <!-- Arrow 2 to 3 -->
  <path d="M 450 150 L 450 200" class="tufte-line"/>

  <!-- Step 3: AI Generates Code -->
  <rect x="320" y="200" width="260" height="120" class="tufte-box"/>
  <text x="450" y="225" class="tufte-text" text-anchor="middle" font-weight="bold">3. AI 코드 생성</text>
  <rect x="335" y="240" width="230" height="70" fill="#ffffff" stroke="#999" stroke-width="1"/>
  <text x="345" y="258" class="tufte-small" font-family="monospace">library(ggplot2)</text>
  <text x="345" y="275" class="tufte-small" font-family="monospace">ggplot(penguins,</text>
  <text x="345" y="292" class="tufte-small" font-family="monospace">  aes(x=species, y=body_mass_g))</text>
  <text x="345" y="309" class="tufte-small" font-family="monospace">  + geom_boxplot()</text>

  <!-- Arrow 3 to 4 -->
  <path d="M 450 320 L 450 370" class="tufte-line"/>
  <text x="490" y="350" class="tufte-small" fill="#999">사용자가 실행 (Enter)</text>

  <!-- Step 4: Code Execution -->
  <rect x="320" y="370" width="260" height="80" class="tufte-box"/>
  <text x="450" y="395" class="tufte-text" text-anchor="middle" font-weight="bold">4. 코드 실행</text>
  <text x="450" y="415" class="tufte-small" text-anchor="middle">R 커널이 코드 실행</text>
  <text x="450" y="430" class="tufte-small" text-anchor="middle">→ 플롯 객체 생성</text>
  <text x="450" y="445" class="tufte-small" text-anchor="middle">→ 메시징 프로토콜로 전송</text>

  <!-- Arrow 4 to 5 -->
  <path d="M 580 410 L 650 410" class="tufte-line"/>

  <!-- Step 5: Plot Display -->
  <rect x="650" y="330" width="220" height="240" class="tufte-box-highlight"/>
  <text x="760" y="350" class="tufte-text" text-anchor="middle" font-weight="bold">5. 플롯 창에 시각화</text>

  <!-- Boxplot visualization -->
  <rect x="665" y="370" width="190" height="180" fill="#ffffff" stroke="#999" stroke-width="1"/>
  <text x="760" y="365" class="tufte-small" text-anchor="middle">Species vs Body Mass</text>

  <!-- Three boxplots -->
  <g transform="translate(0,-13)">
    <!-- Adelie -->
    <rect x="680" y="460" width="40" height="80" fill="#e0e0e0" stroke="#666" stroke-width="1.5"/>
    <line x1="700" y1="420" x2="700" y2="460" stroke="#666" stroke-width="1"/>
    <line x1="700" y1="540" x2="700" y2="560" stroke="#666" stroke-width="1"/>
    <line x1="690" y1="420" x2="710" y2="420" stroke="#666" stroke-width="1.5"/>
    <line x1="690" y1="560" x2="710" y2="560" stroke="#666" stroke-width="1.5"/>
    <text x="700" y="575" class="tufte-small" text-anchor="middle">Adelie</text>

    <!-- Chinstrap -->
    <rect x="735" y="440" width="40" height="90" fill="#d0d0d0" stroke="#666" stroke-width="1.5"/>
    <line x1="755" y1="405" x2="755" y2="440" stroke="#666" stroke-width="1"/>
    <line x1="755" y1="530" x2="755" y2="560" stroke="#666" stroke-width="1"/>
    <line x1="745" y1="405" x2="765" y2="405" stroke="#666" stroke-width="1.5"/>
    <line x1="745" y1="560" x2="765" y2="560" stroke="#666" stroke-width="1.5"/>
    <text x="755" y="575" class="tufte-small" text-anchor="middle">Chinstrap</text>

    <!-- Gentoo -->
    <rect x="790" y="410" width="40" height="120" fill="#c0c0c0" stroke="#666" stroke-width="1.5"/>
    <line x1="810" y1="390" x2="810" y2="410" stroke="#666" stroke-width="1"/>
    <line x1="810" y1="530" x2="810" y2="560" stroke="#666" stroke-width="1"/>
    <line x1="800" y1="390" x2="820" y2="390" stroke="#666" stroke-width="1.5"/>
    <line x1="800" y1="560" x2="820" y2="560" stroke="#666" stroke-width="1.5"/>
    <text x="810" y="575" class="tufte-small" text-anchor="middle">Gentoo</text>
  </g>

  <!-- Left side: Session State Info -->
  <rect x="50" y="200" width="200" height="350" fill="#f9f9f9" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
  <text x="150" y="225" class="tufte-text" text-anchor="middle" font-weight="bold">세션 내부 상태</text>
  <text x="150" y="245" class="tufte-small" text-anchor="middle">(AI가 직접 파악)</text>
  <line x1="50" y1="255" x2="250" y2="255" stroke="#999" stroke-width="1"/>

  <text x="60" y="280" class="tufte-small" font-weight="bold">메모리 데이터:</text>
  <text x="70" y="300" class="tufte-small">• penguins (344 × 8)</text>
  <text x="70" y="320" class="tufte-small">• species: factor</text>
  <text x="70" y="340" class="tufte-small">• body_mass_g: numeric</text>

  <text x="60" y="370" class="tufte-small" font-weight="bold">설치된 패키지:</text>
  <text x="70" y="390" class="tufte-small">• ggplot2 ✓</text>
  <text x="70" y="410" class="tufte-small">• dplyr ✓</text>
  <text x="70" y="430" class="tufte-small">• tidyr ✓</text>

  <text x="60" y="460" class="tufte-small" font-weight="bold">현재 환경:</text>
  <text x="70" y="480" class="tufte-small">• R 4.3.1</text>
  <text x="70" y="500" class="tufte-small">• 작업 디렉토리: ~/project</text>
  <text x="70" y="520" class="tufte-small">• 활성 세션: R</text>

  <!-- Arrow from session state to AI -->
  <path d="M 250 280 L 320 180" stroke="#999" stroke-width="1.5" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow-dash)"/>
  <text x="265" y="270" class="tufte-small" fill="#999">상태 읽기</text>

  <marker id="arrow-dash" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
    <polygon points="0 0, 10 3, 0 6" fill="#999"/>
  </marker>

  <!-- Key Insight Box -->
  <g transform="translate(10, 20)">
    <!-- Outer border (double border effect) -->
    <rect x="596" y="46" width="288" height="83" fill="none" stroke="#333" stroke-width="1" rx="4" ry="4"/>
    <!-- Inner box -->
    <rect x="600" y="50" width="280" height="75" fill="#ffffff" stroke="#333" stroke-width="2.5" rx="4" ry="4"/>
    <text x="740" y="77" class="tufte-title" text-anchor="middle" font-size="15">일반 AI와 결정적 차이</text>
    <text x="740" y="98" class="tufte-text" text-anchor="middle" font-weight="bold">세션 컨텍스트를 모두 본다</text>
    <text x="740" y="116" class="tufte-small" text-anchor="middle" fill="#666">컨텍스트 전달 불필요 · 즉시 실행</text>
  </g>

</svg>
